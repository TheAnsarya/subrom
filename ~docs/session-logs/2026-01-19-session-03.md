# Session 03 - UI-API Integration

**Date:** 2026-01-19
**Duration:** ~30 minutes
**Focus:** Connect React UI to .NET API

## Summary

Connected all React UI pages to the backend API using TanStack React Query and Zustand for state management.

## Changes Made

### New Files Created

#### API Layer (`subrom-ui/src/api/`)
- **client.ts** - Type-safe API client
`t- `fetchApi<T>()` wrapper with error handling
`t- Type definitions: Drive, DatFile, RomFile, ScanJob, RomStats, PagedResult
`t- API modules: drivesApi, datsApi, romsApi, scansApi

- **hooks.ts** - TanStack React Query hooks
`t- `queryKeys` object for cache key management
`t- Drives: useDrives, useDrive, useCreateDrive, useUpdateDrive, useRefreshDrive, useDeleteDrive
`t- DATs: useDats, useDat, useDatProviders, useToggleDat, useDeleteDat
`t- ROMs: useRoms, useRom, useRomStats
`t- Scans: useScans, useScan, useCreateScan, useCancelScan
`t- Automatic polling for running scans

- **index.ts** - Barrel export

#### State Management (`subrom-ui/src/store/`)
- **appStore.ts** - Zustand store
`t- Settings: theme, scanOptions, displaySettings
`t- Persisted to localStorage
`t- Selectors: useTheme, useScanOptions, useDisplaySettings

- **index.ts** - Barrel export

### Pages Updated

1. **Dashboard.tsx**
`t - Real data from useDrives, useRomStats, useScans, useDatProviders
`t - Loading spinners
`t - Recent scans list instead of mock activity
`t - DAT providers summary

2. **DriveManager.tsx**
`t - Full CRUD operations
`t - Add drive modal with form validation
`t - Loading/empty/error states
`t - Offline drives summary (dynamic)

3. **DatManager.tsx**
`t - Real data from useDats, useDatProviders
`t - Toggle enable/disable
`t - Delete with confirmation
`t - Dynamic provider filter

4. **RomBrowser.tsx**
`t - Real data from useRoms with pagination
`t - Drive sidebar (replaces mock system tree)
`t - Filter by status (online/offline/verified)
`t - Search functionality

5. **Settings.tsx**
`t - Uses Zustand store
`t - Theme selection (light/dark/system)
`t - Scan options (recursive, verify hashes, skip existing)
`t - Display settings (page size, show offline, confirm deletes)
`t - Settings persist to localStorage

### CSS Updates
- DriveManager.css: Modal, loading container, empty state, error message styles
- Settings.css: Info box, input readonly styles

## GitHub Issues
- Created issue #29: feat: Connect UI to API with React Query and Zustand

## Commits
- `a95763d` - feat: Connect UI to API with React Query and Zustand (closes #29)

## Technical Notes

### React Query Configuration
- Queries automatically refetch on window focus
- Scans poll every 2s when running scans exist
- Active scan polls every 1s
- Cache invalidation on mutations

### Zustand Store
- Persisted subset (settings only)
- Transient state (activeScanId, selectedDriveId) not persisted
- Type-safe with TypeScript

### Modern React Patterns Used
- Function components (no React.FC)
- useMemo for expensive computations
- Proper TypeScript types from API
- Conditional rendering patterns

## What's Next

1. **Install Frontend Dependencies**
`t - Run `npm install` in subrom-ui/
`t - Verify all new packages install correctly

2. **Test API Integration**
`t - Start backend: `dotnet run --project Subrom/SubromAPI.csproj`
`t - Start frontend: `npm run dev` in subrom-ui/
`t - Test all pages against real API

3. **Implement Background Scanning**
`t - BackgroundService for scan jobs
`t - SignalR for real-time progress updates
`t - Scan queue management

4. **DAT Import Functionality**
`t - File upload endpoint
`t - Wire existing parsers (XmlDatParser, ClrMameProDatParser)
`t - Import progress feedback

5. **Verification Workflow**
`t - Compare scanned ROMs against DAT entries
`t - Match by SHA1 > MD5 > CRC32
`t - Update verification status
